<!DOCTYPE html>

<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>J.J. Joias – Brilho que conta histórias</title>

  <!-- Fontes e ícones -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --gold: #c29d5f;
      --gold-dark: #a67c37;
      --white: #ffffff;
      --dark: #121212;
      --bg-light: #faf7f5;
      --text-dark: #222;
      --transition: 0.25s ease;
    }

    /* Base */
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins",sans-serif;
      background:var(--bg-light);
      color:var(--text-dark);
      transition: background var(--transition), color var(--transition);
      overflow-x:hidden;
    }

    /* HEADER */
    header{
      position:fixed; top:0; left:0; right:0;
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      padding:0 20px;
      background:var(--white);
      box-shadow:0 2px 10px rgba(0,0,0,0.06);
      z-index:1200;
    }
    .left, .center, .right { display:flex; align-items:center; gap:12px; }
    .logo{ font-weight:700; color:var(--gold); font-size:1.1rem; margin-left:6px }

    nav{ gap:22px; display:flex; justify-content:center; align-items:center; flex:1; }
    nav a{ text-decoration:none; color:var(--text-dark); font-weight:600; position:relative; padding:6px 2px; }
    nav a::after{ content:""; position:absolute; left:0; bottom:-6px; height:2px; width:0; background:var(--gold); transition:width .25s; }
    nav a:hover::after{ width:100%; }

    /* search + theme */
    .search-bar{
      display:flex; align-items:center; gap:8px;
      background:var(--bg-light); padding:6px 10px; border-radius:10px; border:1px solid #e6e6e6;
    }
    .search-bar input{
      border:0; outline:0; background:transparent; width:160px; font-size:0.95rem;
      transition: width .25s;
    }
    .search-bar input:focus{ width:230px; }

    .theme-toggle{
      background:none; border:0; cursor:pointer; font-size:1.05rem; color:var(--gold-dark);
      padding:6px;
    }


    /* SIDEBAR (área do usuário) */
    .sidebar{
      position:fixed; left:-280px; top:0; height:100vh; width:260px;
      padding:28px 18px; background:var(--white); box-shadow:3px 0 18px rgba(0,0,0,0.12);
      transition:left .32s ease; z-index:1300; overflow:auto;
    }
    .sidebar.active{ left:0; }
    .sidebar h2{ color:var(--gold-dark); margin-bottom:14px; }
    .sidebar a{
      display:flex; gap:12px; align-items:center; text-decoration:none; color:var(--text-dark);
      padding:10px 6px; border-radius:8px; font-weight:600; transition: background .18s, color .18s;
    }
    .sidebar a:hover{ background: #f6f0df; color:var(--gold-dark); }

    /* OVERLAY (clicar fora fecha sidebar) */
    .overlay{
      position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; z-index:1250;
    }
    .overlay.active{ display:block; }

    /* HERO */
    .hero{
      padding:110px 20px 30px; text-align:center; background:var(--white);
    }
    .hero h1{ color:var(--gold); font-size:2.1rem; margin-bottom:8px; font-weight:700; }
    .hero p{ max-width:760px; margin:0 auto; color:#444; line-height:1.5; }

    /* CARROSSEL (mostra 2 por vez em desktop, 1 em mobile) */
    .carousel{
      display:flex;
      gap:18px;
      padding:28px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      scroll-behavior:smooth;
      -webkit-overflow-scrolling:touch;
      cursor:grab;
    }
    .carousel.dragging{ cursor:grabbing; }
    .carousel::-webkit-scrollbar{ height:8px; }
    .carousel::-webkit-scrollbar-thumb{ background:rgba(0,0,0,0.12); border-radius:6px; }


    .carousel-item{
      scroll-snap-align:start;
      flex:0 0 calc(50% - 9px); /* 2 por vez */
      background:var(--white);
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      padding:18px;
      transition:transform .22s;
    }
    .carousel-item:hover{ transform:translateY(-6px); }
    .carousel-item h3{ color:var(--gold); margin-bottom:8px; font-size:1.05rem; }


    @media (max-width:720px){
      .carousel-item{ flex:0 0 86%; } /* 1 por vez em celular */
      nav{ display:none; } /* simplifica nav em celular; keep search + icons */
    }


    /* SECTIONS */
    section{ padding:10px 0 30px; }
    #presentes h2, #ocasioes h2{ text-align:center; color:var(--gold); margin-top:6px; margin-bottom:6px; font-family:inherit; }

    /* SERVIÇOS - detalhes em overlay */
    .service-overlay{
      position:fixed; inset:0; display:none; justify-content:center; align-items:center; z-index:1400;
      background: rgba(0,0,0,0.6);
    }
    .service-overlay.active{ display:flex; }
    .service-box{
      max-width:720px; width:92%; background:var(--white); border-radius:12px; padding:22px; color:var(--text-dark);
      box-shadow:0 8px 30px rgba(0,0,0,0.3); line-height:1.55; text-align:left;
    }
    .service-box h2{ color:var(--gold); margin-bottom:10px; }

    /* BOTÕES flutuantes (WhatsApp / Instagram) */
    .float-btn{ position:fixed; right:20px; bottom:18px; display:flex; flex-direction:column; gap:12px; z-index:1500; }
    .float-btn a{
      width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center;
      color:#fff; text-decoration:none; box-shadow:0 6px 18px rgba(0,0,0,0.18); transition: transform .2s;
    }
    .float-btn a:hover{ transform:translateY(-6px); }
    .whatsapp{ background:#25D366; }
    .instagram{ background:linear-gradient(45deg,#F58529,#DD2A7B,#8134AF); }

    /* FOOTER */
    footer{ padding:28px; text-align:center; background:var(--dark); color:var(--white); margin-top:20px; }

    /* DARK MODE (tema escuro) - ajustes de contraste apenas */
    .dark-mode{
      background:#0b0b0c; color:#eaeaea; /* increased contrast */
    }
    .dark-mode header{ background:#0e0e0f; box-shadow:0 2px 12px rgba(0,0,0,0.6); }
    .dark-mode .sidebar{ background:#101010; color:#f5f5f5; box-shadow:3px 0 18px rgba(0,0,0,0.6); }
    .dark-mode .service-box, .dark-mode .carousel-item, .dark-mode .hero{ background:#141414; color:#f5f5f5; box-shadow:0 6px 20px rgba(0,0,0,0.6); }
    .dark-mode footer{ background:#070707; color:#fff; }
    .dark-mode .search-bar{ background:#0d0d0d; border-color:#222; }
    .dark-mode nav a{ color:#f0f0f0; }
    .dark-mode .logo{ color:var(--gold); }

    /* pequenas melhorias de acessibilidade/visual */
    a[aria-hidden="true"]{ pointer-events:none; opacity:0.6; }

    /* ------------------ NEW COMPONENTS (modals, catalog, login, profile, orders, novidades page) ------------------ */
    /* Note: we only ADD styles, keeping existing spacing/typography intact */

    .modal-overlay{ position:fixed; inset:0; display:none; justify-content:center; align-items:flex-start; padding-top:72px; z-index:1600; background: rgba(0,0,0,0.5); }
    .modal-overlay.active{ display:flex; }
    .modal{ width:min(940px,96%); max-height:80vh; overflow:auto; background:var(--white); border-radius:12px; padding:20px; box-shadow:0 14px 40px rgba(0,0,0,0.35); }
    .modal h2{ color:var(--gold); margin-top:0 }
    .modal .row{ display:flex; gap:12px; flex-wrap:wrap }

    /* catalog grid */
    .catalog-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:14px; }
    .product{ border:1px solid #eee; border-radius:10px; padding:12px; background:transparent; display:flex; flex-direction:column; gap:8px }
    .product .meta{ display:flex; align-items:center; gap:8px }
    .product .meta i{ font-size:1.25rem }
    .product button{ margin-top:auto; padding:8px 10px; border-radius:8px; background:var(--gold); color:#fff; border:0; cursor:pointer }

    /* small form styles */
    .form-row{ display:flex; gap:8px; margin-bottom:8px; }
    .form-row input, .form-row select{ padding:10px; border-radius:8px; border:1px solid #ddd; flex:1 }

    /* simple cart badge */
    .cart-summary{ display:flex; gap:12px; align-items:center; justify-content:space-between; padding:6px 10px; border-radius:8px; border:1px dashed #ddd }

    /* Instagram novidades internal page area */
    #novidadesPage{ padding:110px 20px 40px; display:none }
    #novidadesPage.active{ display:block }
    .insta-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px }
    .insta-card{ background:var(--white); border-radius:8px; padding:8px; text-align:center; }

    /* small utility */
    .muted{ color:#666 }

  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="left">
      <i class="fa-solid fa-house home-icon" id="homeBtn" title="Área do usuário"></i>
      <div class="logo">J.J. Joias</div>
    </div>

    <div class="center">
      <nav aria-label="Principal">
        <a href="#inicio">Início</a>
        <a href="#presentes">Presentes</a>
        <a href="#ocasioes">Ocasiões</a>
        <a href="#servicos">Serviços</a>
        <a href="#novidades" id="novidadesLink">Novidades</a>
      </nav>
    </div>

    <div class="right">
      <div class="search-bar" title="Pesquisar">
        <input id="searchInput" type="text" placeholder="Buscar joias..." aria-label="Buscar joias">
        <i class="fa-solid fa-magnifying-glass"></i>
      </div>
      <button id="themeToggle" class="theme-toggle" title="Alternar tema" aria-label="Alternar tema">
        <i class="fa-solid fa-circle-half-stroke"></i>
      </button>
    </div>
  </header>


  <!-- SIDEBAR (Área do usuário) -->
  <aside class="sidebar" id="sidebar" aria-hidden="true">
    <h2>Área do Usuário</h2>
    <a href="#" id="btnLogin"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
    <a href="#" id="btnCatalog"><i class="fa-solid fa-bag-shopping"></i> Catálogo</a>
    <a href="#" id="btnProfile"><i class="fa-solid fa-user"></i> Perfil</a>
    <a href="#" id="btnOrders"><i class="fa-solid fa-cart-shopping"></i> Meus Pedidos</a>
  </aside>


  <!-- Overlay (clica fora fecha sidebar) -->
  <div class="overlay" id="overlay"></div>


  <!-- HERO -->
  <main>
    <section id="inicio" class="hero">
      <h1>Descubra o brilho que combina com você</h1>
      <p>Desde alianças de casamento até presentes de formatura — cada joia da J.J. Joias é feita para eternizar momentos.</p>
    </section>

    <!-- GUIA DE PRESENTES (carrossel arrastável) -->
    <section id="presentes">
      <h2>Guia de Presentes</h2>
      <div class="carousel" id="presentesCarousel" aria-label="Guia de Presentes">
        <article class="carousel-item">
          <h3>Colar Personalizado</h3>
          <p>Pingentes gravados com nomes ou datas — ideal para namoro e aniversários.</p>
        </article>

        <article class="carousel-item">
          <h3>Anel de Formatura</h3>
          <p>Peças com símbolos e gravações que eternizam sua conquista.</p>
        </article>

        <article class="carousel-item">
          <h3>Pulseira Elegante</h3>
          <p>Design fino, ótima opção de presente sofisticado para ocasiões especiais.</p>
        </article>

        <article class="carousel-item">
          <h3>Brincos Luxuosos</h3>
          <p>Com pedras e acabamentos nobres para comemorar momentos marcantes.</p>
        </article>
      </div>
    </section>

    <!-- OCASIÕES (apresenta 2 por vez em desktop) -->
    <section id="ocasioes" style="padding:20px 0;">
      <h2>Ocasiões Especiais</h2>
      <div class="carousel" id="ocasioesCarousel" aria-label="Ocasiões Especiais">
        <article class="carousel-item">
          <h3>Casamentos</h3>
          <p>Conjuntos de alianças, colares e conjuntos para noivos, acabamento perfeito para o grande dia.</p>
        </article>

        <article class="carousel-item">
          <h3>Namoro</h3>
          <p>Pingentes de coração, colares gravados e conjuntos “couple” para celebrar o amor.</p>
        </article>

        <article class="carousel-item">
          <h3>Aniversários</h3>
          <p>Peças escolhidas para marcar data com elegância e significado.</p>
        </article>

        <article class="carousel-item">
          <h3>Conquistas</h3>
          <p>Joias comemorativas — formaturas, promoções e metas alcançadas.</p>
        </article>

      </div>
    </section>

    <!-- SERVIÇOS -->
    <section id="servicos" style="padding:26px 20px; background:transparent; text-align:center;">
      <h2 style="color:var(--gold);">Serviços Exclusivos</h2>
      <p>Nosso compromisso vai além da joia — cuidamos de cada detalhe com técnicas especializadas.</p>
      <div style="margin-top:14px;">
        <button id="openServicesBtn">Saiba mais</button>
      </div>
    </section>

    <!-- NOVIDADES INTERNAL PAGE (will be shown when clicking Novidades) -->
    <section id="novidadesPage" aria-label="Novidades Internas">
      <h2 style="text-align:center; color:var(--gold);">Novidades — Instagram</h2>
      <p style="text-align:center; max-width:820px; margin:0 auto 18px;" class="muted">Conteúdo integrado a partir do perfil oficial da loja. Caso o navegador bloqueie embeds, use o botão para abrir o Instagram diretamente.</p>

      <!-- Attempt to embed profile via iframe (simple integration). If browser blocks, shows fallback cards -->
      <div style="text-align:center; margin-bottom:12px;">
        <a id="openInstaBtnNav" class="instagram" href="#" style="display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:10px; color:#fff; text-decoration:none;" target="_blank">Abrir Instagram</a>
      </div>

      <div id="instaEmbedArea" style="max-width:980px; margin:0 auto;">
        <!-- Primary: iframe to profile (may be blocked by Instagram but is a valid embed approach requested) -->
        <iframe id="instaIframe" src="https://www.instagram.com/j.j.joias_2024/" style="width:100%; height:540px; border:0; border-radius:10px;" title="Instagram J.J. Joias"></iframe>

        <!-- Fallback grid (if iframe cannot show due to embed restrictions) -->
        <div id="instaFallback" class="insta-grid" style="display:none; margin-top:12px">
          <!-- These are placeholders; if you want real posts via API, configure a server-side call to Instagram Graph API and inject HTML here. -->
          <div class="insta-card">Post 1 — preview</div>
          <div class="insta-card">Post 2 — preview</div>
          <div class="insta-card">Post 3 — preview</div>
          <div class="insta-card">Post 4 — preview</div>
        </div>
      </div>
    </section>

  </main>

  <!-- SOBREPOSIÇÃO DE SERVIÇOS (detalhes) -->
  <div class="service-overlay" id="serviceOverlay" aria-hidden="true">
    <div class="service-box" role="dialog" aria-modal="true" aria-labelledby="servicesTitle">
      <h2 id="servicesTitle">Como fazemos (resumo técnico)</h2>

      <p><strong>Polimento e restauração</strong><br>
      Primeiro a peça passa por limpeza ultrassônica para remover sujeiras. Em seguida fazemos polimento com abrasivos progressivos (pastas e discos especiais) para remover micro-arranhões e recuperar o brilho. Finalizamos com limpeza e inspeção.</p>

      <p><strong>Gravação a laser</strong><br>
      Projetamos o texto ou símbolo digitalmente e marcamos a peça com laser de precisão, que permite gravações finas, legíveis e duráveis em metais como ouro e prata. É ideal para nomes, datas e pequenos desenhos.</p>

      <p><strong>Soldas e ajustes</strong><br>
      Utilizamos ligas e técnicas compatíveis (solda a oxíteno, micro-solda elétrica ou laser) para unir partes, ajustar tamanhos e reparar danos, seguido de acabamento e polimento para esconder pontos de intervenção.</p>

      <p><strong>Criação sob medida</strong><br>
      Trabalhamos a partir de projeto: modelagem em CAD (quando necessário), escolha de materiais e pedras, prototipagem e produção com acabamento artesanal e controle de qualidade.</p>

      <div style="text-align:right; margin-top:12px;">
        <button onclick="toggleServiceOverlay(false)">Fechar</button>
      </div>
    </div>
  </div>

  <!-- RODAPÉ -->
  <footer>
    <p>© 2025 J.J. Joias — Tradição, Arte e Exclusividade</p>
  </footer>

  <!-- BOTÕES FLUTUANTES DE CONTATO -->
  <div class="float-btn" aria-hidden="false">
    <a class="whatsapp" href="https://wa.me/55XXXXXXXXXXX" target="_blank" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
    <!-- UPDATED: instagram floating now points to exact URL provided by user (requirement) -->
    <a class="instagram" id="floatInsta" href="https://www.instagram.com/j.j.joias_2024?igsh=bXloZmhycGp4c3h1" target="_blank" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
  </div>

  <!-- NEW: Generic modal overlay used for Login, Catalog, Profile, Orders, Saiba Mais page modal -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" id="modalContent" aria-modal="true">
      <!-- content injected by JS -->
    </div>
  </div>


  <!-- SCRIPTS: drag carousels, sidebar, overlay, theme, plus new logic for login/catalog/profile/orders/instagram -->
  <script>
    /* --------------------------
       NOTE: Modifications are only additions. Existing IDs and classes were NOT renamed.
       Comments in this script mark added functionality:
       - Login (email validation + persistence)
       - Catalog (add to cart, icons)
       - Profile (dynamic update)
       - Orders (store & display orders)
       - Novidades (internal page + iframe + fallback)
       - Floating Instagram button updated to required link (kept class 'instagram')
    -------------------------- */

    // Sidebar toggle (ícone de casinha)
    const homeBtn = document.getElementById('homeBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    function openSidebar(){
      sidebar.classList.add('active');
      overlay.classList.add('active');
      sidebar.setAttribute('aria-hidden','false');
    }
    function closeSidebar(){
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      sidebar.setAttribute('aria-hidden','true');
    }

    homeBtn && homeBtn.addEventListener('click', () => {
      if(sidebar.classList.contains('active')) closeSidebar();
      else openSidebar();
    });

    // clicar fora fecha
    overlay && overlay.addEventListener('click', () => { closeSidebar(); closeModal(); });

    // fechar com ESC
    document.addEventListener('keydown', (e)=>{
      if(e.key === "Escape"){
        closeSidebar();
        toggleServiceOverlay(false);
        closeModal();
      }
    });

    // Theme toggle (persistente) - kept the same but dark palette adjusted above for readability
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    const savedTheme = localStorage.getItem('jj_theme');
    if(savedTheme === 'dark'){ body.classList.add('dark-mode'); }
    themeToggle && themeToggle.addEventListener('click', ()=>{
      body.classList.toggle('dark-mode');
      localStorage.setItem('jj_theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
    });

    // Service overlay (existing)
    const serviceOverlay = document.getElementById('serviceOverlay');
    const openServicesBtn = document.getElementById('openServicesBtn');
    function toggleServiceOverlay(show){
      serviceOverlay.classList.toggle('active', !!show);
      serviceOverlay.setAttribute('aria-hidden', show ? 'false' : 'true');
    }
    openServicesBtn && openServicesBtn.addEventListener('click', ()=> toggleServiceOverlay(true));
    serviceOverlay && serviceOverlay.addEventListener('click', (e)=>{
      if(e.target === serviceOverlay) toggleServiceOverlay(false);
    });

    // CARROSSEIS: drag to scroll (works for any element with class .carousel)
    const carousels = document.querySelectorAll('.carousel');
    carousels.forEach(carousel => {
      let isDown = false;
      let startX;
      let scrollLeft;

      // Pointer events for mouse & touch
      carousel.addEventListener('pointerdown', (e)=>{
        isDown = true;
        carousel.classList.add('dragging');
        startX = e.pageX - carousel.offsetLeft;
        scrollLeft = carousel.scrollLeft;
        carousel.setPointerCapture(e.pointerId);
      });

      carousel.addEventListener('pointermove', (e)=>{
        if(!isDown) return;
        e.preventDefault();
        const x = e.pageX - carousel.offsetLeft;
        const walk = (x - startX) * 1; // multiplier for speed
        carousel.scrollLeft = scrollLeft - walk;
      });

      carousel.addEventListener('pointerup', (e)=>{
        isDown = false;
        carousel.classList.remove('dragging');
        try { carousel.releasePointerCapture(e.pointerId); } catch(err){ /* ignore */ }
      });

      carousel.addEventListener('pointercancel', ()=>{
        isDown = false;
        carousel.classList.remove('dragging');
      });

      // wheel -> horizontal scroll
      carousel.addEventListener('wheel', (e)=>{
        if(Math.abs(e.deltaY) > 0){
          e.preventDefault();
          carousel.scrollLeft += e.deltaY;
        }
      }, { passive:false });
    });

    // (Opcional) fechar a sidebar quando o usuário clica em qualquer link dela
    document.querySelectorAll('.sidebar a').forEach(a=>{
      a.addEventListener('click', ()=>{ closeSidebar(); });
    });

    // SEARCH: permite digitar (já funcional). Adicionei um pequeno comportamento (Enter)
    const searchInput = document.getElementById('searchInput');
    searchInput && searchInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        const q = searchInput.value.trim();
        if(q) alert('Pesquisar por: ' + q);
      }
    });

    // Bottleneck: garantir que carousels iniciem um pouco deslocados (opcional)
    window.addEventListener('load', ()=>{
      carousels.forEach(c => c.scrollLeft = 0);
    });

    /* -------------------- NEW: Modal management for Login, Catalog, Profile, Orders -------------------- */
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');

    function openModal(html){
      modalContent.innerHTML = html;
      modalOverlay.classList.add('active');
      modalOverlay.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modalOverlay.classList.remove('active');
      modalOverlay.setAttribute('aria-hidden','true');
      modalContent.innerHTML = '';
    }

    modalOverlay.addEventListener('click', (e)=>{ if(e.target === modalOverlay) closeModal(); });

    // Simple localStorage-backed state
    const STATE = {
      user: JSON.parse(localStorage.getItem('jj_user') || 'null'),
      cart: JSON.parse(localStorage.getItem('jj_cart') || '[]'),
      orders: JSON.parse(localStorage.getItem('jj_orders') || '[]')
    };

    function saveState(){
      localStorage.setItem('jj_user', JSON.stringify(STATE.user));
      localStorage.setItem('jj_cart', JSON.stringify(STATE.cart));
      localStorage.setItem('jj_orders', JSON.stringify(STATE.orders));
    }

    /* -------------------- LOGIN -------------------- */
    const btnLogin = document.getElementById('btnLogin');
    btnLogin && btnLogin.addEventListener('click', (e)=>{
      e.preventDefault();
      openLoginModal();
    });

    function openLoginModal(){
      const html = `
        <h2>Login</h2>
        <p class="muted">Insira seu e-mail para acessar sua conta. O e-mail será validado.</p>
        <div class="form-row">
          <input id="loginEmail" type="email" placeholder="seu@email.com" />
          <button id="doLogin">Entrar</button>
        </div>
        <div id="loginMsg" class="muted"></div>
      `;
      openModal(html);
      document.getElementById('doLogin').addEventListener('click', handleLogin);
      document.getElementById('loginEmail').addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleLogin(); });
    }

    function handleLogin(){
      const email = document.getElementById('loginEmail').value.trim();
      const msg = document.getElementById('loginMsg');
      if(!validateEmail(email)){
        msg.textContent = 'E-mail inválido. Use o formato nome@dominio.com';
        return;
      }
      STATE.user = { email: email, name: email.split('@')[0] };
      saveState();
      msg.textContent = 'Login realizado com sucesso!';
      setTimeout(()=>{ closeModal(); alert('Bem-vindo, ' + STATE.user.name); }, 700);
    }

    function validateEmail(email){
      // simple digit-by-digit validation per instruction (work out carefully)
      if(!email || typeof email !== 'string') return false;
      const parts = email.split('@');
      if(parts.length !== 2) return false;
      const local = parts[0];
      const domain = parts[1];
      if(local.length < 1 || domain.length < 3) return false;
      if(domain.indexOf('.') === -1) return false;
      // ensure domain parts are >1 char
      const dparts = domain.split('.');
      for(let p of dparts){ if(p.length < 2) return false; }
      return true;
    }

    /* -------------------- CATALOG -------------------- */
    // Sample catalog data (added, does not modify existing layout). Each item has a 'type' for icon.
    const CATALOG = [
      { id: 'p1', title: 'Colar Personalizado', price: 129.90, type: 'jewelry', desc: 'Pingente gravado com nomes ou datas.' },
      { id: 'p2', title: 'Anel de Formatura', price: 249.00, type: 'jewelry', desc: 'Anel com gravações simbólicas.' },
      { id: 's1', title: 'Polimento Profissional', price: 49.00, type: 'service', desc: 'Restauração e polimento.' },
      { id: 's2', title: 'Gravação a Laser', price: 79.00, type: 'service', desc: 'Gravações precisas e duráveis.' }
    ];

    const btnCatalog = document.getElementById('btnCatalog');
    btnCatalog && btnCatalog.addEventListener('click', (e)=>{ e.preventDefault(); openCatalog(); });

    function openCatalog(){
      let html = `<h2>Catálogo</h2><p class="muted">Monte seu carrinho com peças e serviços.</p>`;
      html += `<div class="catalog-grid">`;
      CATALOG.forEach(item => {
        const icon = item.type === 'service' ? 'fa-tools' : 'fa-gem';
        html += `
          <div class="product">
            <div class="meta"><i class="fa-solid ${icon}"></i><strong>${item.title}</strong></div>
            <div class="muted">${item.desc}</div>
            <div style="font-weight:700">R$ ${item.price.toFixed(2)}</div>
            <div style="display:flex; gap:8px; margin-top:6px;">
              <button data-id="${item.id}" class="addToCartBtn">Adicionar</button>
              <button data-id="${item.id}" class="buyNowBtn">Comprar</button>
            </div>
          </div>
        `;
      });
      html += `</div>
        <div style="margin-top:12px;">
          <div class="cart-summary"><div>Itens no carrinho: <span id="cartCount">${STATE.cart.length}</span></div><div><button id="viewCart">Ver carrinho</button></div></div>
        </div>`;

      openModal(html);

      // attach handlers
      document.querySelectorAll('.addToCartBtn').forEach(b=> b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-id'); addToCart(id);
      }));
      document.querySelectorAll('.buyNowBtn').forEach(b=> b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-id'); addToCart(id); placeOrder();
      }));
      document.getElementById('viewCart').addEventListener('click', renderCartInModal);
    }

    function addToCart(id){
      const item = CATALOG.find(x=>x.id===id);
      if(!item) return;
      STATE.cart.push({ ...item, addedAt: Date.now(), qty:1 });
      saveState();
      const el = document.getElementById('cartCount'); if(el) el.textContent = STATE.cart.length;
      alert(item.title + ' adicionado ao carrinho');
    }

    function renderCartInModal(){
      let html = `<h2>Seu Carrinho</h2>`;
      if(STATE.cart.length === 0) html += `<p class="muted">Carrinho vazio.</p>`;
      else{
        html += `<div style="display:flex;flex-direction:column;gap:8px">`;
        STATE.cart.forEach((it, idx)=>{
          html += `<div style="display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;padding:8px 0"><div><strong>${it.title}</strong><div class="muted">R$ ${it.price.toFixed(2)}</div></div><div style="display:flex;gap:8px"><button data-idx="${idx}" class="removeItem">Remover</button><div>qtd: ${it.qty}</div></div></div>`;
        });
        html += `</div>`;
        const total = STATE.cart.reduce((s,i)=> s + i.price*i.qty, 0);
        html += `<div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center"><div>Total: <strong>R$ ${total.toFixed(2)}</strong></div><div><button id="checkoutBtn">Finalizar</button></div></div>`;
      }
      openModal(html);
      document.querySelectorAll('.removeItem').forEach(b=> b.addEventListener('click', ()=>{ const idx = +b.getAttribute('data-idx'); STATE.cart.splice(idx,1); saveState(); renderCartInModal(); }));
      const checkoutBtn = document.getElementById('checkoutBtn'); if(checkoutBtn) checkoutBtn.addEventListener('click', ()=>{ placeOrder(); });
    }

    function placeOrder(){
      if(STATE.cart.length === 0){ alert('Carrinho vazio'); return; }
      // require login
      if(!STATE.user){ alert('Faça login antes de finalizar o pedido'); openLoginModal(); return; }
      const order = { id: 'ord_' + Date.now(), date: new Date().toISOString(), items: STATE.cart.slice(), total: STATE.cart.reduce((s,i)=> s + i.price*i.qty, 0) };
      STATE.orders.push(order);
      STATE.cart = [];
      saveState();
      closeModal();
      alert('Pedido realizado com sucesso! ID: ' + order.id);
    }

    /* -------------------- PROFILE -------------------- */
    const btnProfile = document.getElementById('btnProfile');
    btnProfile && btnProfile.addEventListener('click', (e)=>{ e.preventDefault(); openProfile(); });

    function openProfile(){
      let html = `<h2>Perfil</h2>`;
      if(!STATE.user){ html += `<p class="muted">Você não está logado.</p><p><button id="goLogin">Fazer login</button></p>`; }
      else{
        html += `<div class="form-row"><label style="min-width:80px">Nome</label><input id="profileName" value="${escapeHtml(STATE.user.name || '')}" /></div>`;
        html += `<div class="form-row"><label style="min-width:80px">Email</label><input id="profileEmail" value="${escapeHtml(STATE.user.email || '')}" /></div>`;
        html += `<div style="text-align:right"><button id="saveProfile">Salvar</button></div>`;
      }
      openModal(html);
      const goLogin = document.getElementById('goLogin'); if(goLogin) goLogin.addEventListener('click', ()=>{ closeModal(); openLoginModal(); });
      const saveProfile = document.getElementById('saveProfile'); if(saveProfile) saveProfile.addEventListener('click', ()=>{
        const name = document.getElementById('profileName').value.trim();
        const email = document.getElementById('profileEmail').value.trim();
        if(!validateEmail(email)){ alert('Email inválido'); return; }
        STATE.user = { name:name, email:email };
        saveState();
        alert('Perfil atualizado');
        closeModal();
      });
    }

    /* -------------------- ORDERS -------------------- */
    const btnOrders = document.getElementById('btnOrders');
    btnOrders && btnOrders.addEventListener('click', (e)=>{ e.preventDefault(); openOrders(); });

    function openOrders(){
      let html = `<h2>Meus Pedidos</h2>`;
      if(!STATE.user){ html += `<p class="muted">Faça login para ver seus pedidos.</p><p><button id="goLogin2">Fazer login</button></p>`; }
      else{
        if(STATE.orders.length === 0) html += `<p class="muted">Nenhum pedido registrado.</p>`;
        else{
          html += `<div style="display:flex;flex-direction:column;gap:10px">`;
          STATE.orders.forEach(o=>{
            html += `<div style="border:1px solid #eee;padding:10px;border-radius:8px"><div><strong>ID:</strong> ${o.id}</div><div class="muted">Data: ${new Date(o.date).toLocaleString()}</div><div><strong>Total:</strong> R$ ${o.total.toFixed(2)}</div></div>`;
          });
          html += `</div>`;
        }
      }
      openModal(html);
      const goLogin2 = document.getElementById('goLogin2'); if(goLogin2) goLogin2.addEventListener('click', ()=>{ closeModal(); openLoginModal(); });
    }

    /* -------------------- Novidades link behavior -------------------- */
    const novidadesLink = document.getElementById('novidadesLink');
    const novidadesPage = document.getElementById('novidadesPage');
    const openInstaBtnNav = document.getElementById('openInstaBtnNav');
    const floatInsta = document.getElementById('floatInsta');

    novidadesLink && novidadesLink.addEventListener('click', (e)=>{
      e.preventDefault();
      // show internal page section (keeps nav spacing)
      // hide main scroll to make it look like new page
      document.querySelectorAll('main > section').forEach(s=> s.style.display = 'none');
      novidadesPage.classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // set link for open button
      openInstaBtnNav.href = 'https://www.instagram.com/j.j.joias_2024?igsh=bXloZmhycGp4c3h1';
    });

    // Floating button already updated in markup. Ensure it opens new tab (it does via target='_blank')

    // If iframe is blocked or returns blank, show fallback
    const instaIframe = document.getElementById('instaIframe');
    function checkInstaFrame(){
      try{
        const doc = instaIframe.contentDocument || instaIframe.contentWindow.document;
        const body = doc && doc.body && doc.body.innerHTML;
        // If cross-origin, access will throw; fallback will be used in that case
      }catch(err){
        // Cannot access iframe due to CORS -> show fallback grid and a message
        document.getElementById('instaFallback').style.display = 'grid';
        instaIframe.style.display = 'none';
      }
    }
    instaIframe && instaIframe.addEventListener('load', checkInstaFrame);

    document.getElementById('openInstaBtnNav').addEventListener('click', ()=>{
      window.open('https://www.instagram.com/j.j.joias_2024?igsh=bXloZmhycGp4c3h1','_blank');
    });

    /* Utility */
    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; }); }

    // Ensure cart/orders badge in catalog updates after load
    window.addEventListener('load', ()=>{
      // keep original behaviour
      carousels.forEach(c => c.scrollLeft = 0);
    });

    /* End of additions */
  </script>
</body>

</html>
